<!DOCTYPE html>
<html lang="en" class="Internet-Draft">
<head>
<meta charset="utf-8">
<meta content="Common,Latin" name="scripts">
<meta content="initial-scale=1.0" name="viewport">
<title>The DNSCrypt protocol</title>
<meta content="Frank Denis" name="author">
<meta content="
       The DNSCrypt protocol is designed to encrypt and authenticate DNS traffic between clients and resolvers. This document specifies the protocol and its implementation. 
    " name="description">
<meta content="xml2rfc 3.19.2" name="generator">
<meta content="dns" name="keyword">
<meta content="encryption" name="keyword">
<meta content="privacy" name="keyword">
<meta content="draft-denis-dprive-dnscrypt-latest" name="ietf.draft">
<!-- Generator version information:
  xml2rfc 3.19.2
    Python 3.11.6
    ConfigArgParse 1.7
    google-i18n-address 3.1.0
    intervaltree 3.1.0
    Jinja2 3.1.2
    lxml 4.9.3
    platformdirs 4.2.0
    pycountry 22.3.5
    PyYAML 6.0.1
    requests 2.31.0
    setuptools 68.2.2
    six 1.16.0
    wcwidth 0.2.13
-->
<link href="draft-denis-dprive-dnscrypt.xml" rel="alternate" type="application/rfc+xml">
<link href="#copyright" rel="license">
<style type="text/css">@font-face {
  font-family: 'Lora';
  font-style: italic;
  font-weight: 400;
  font-display: swap;
  src: local('Lora Italic'), local('Lora-Italic'), url('https://martinthomson.github.io/rfc-css/fonts/lora-italic-cyrillic-ext.woff2') format('woff2');
  unicode-range: U+0460-052F, U+1C80-1C88, U+20B4, U+2DE0-2DFF, U+A640-A69F, U+FE2E-FE2F;
}
@font-face {
  font-family: 'Lora';
  font-style: italic;
  font-weight: 400;
  font-display: swap;
  src: local('Lora Italic'), local('Lora-Italic'), url('https://martinthomson.github.io/rfc-css/fonts/lora-italic-cyrillic-ext.woff2') format('woff2');
  unicode-range: U+0400-045F, U+0490-0491, U+04B0-04B1, U+2116;
}
@font-face {
  font-family: 'Lora';
  font-style: italic;
  font-weight: 400;
  font-display: swap;
  src: local('Lora Italic'), local('Lora-Italic'), url('https://martinthomson.github.io/rfc-css/fonts/lora-italic-vietnamese.woff2') format('woff2');
  unicode-range: U+0102-0103, U+0110-0111, U+1EA0-1EF9, U+20AB;
}
@font-face {
  font-family: 'Lora';
  font-style: italic;
  font-weight: 400;
  font-display: swap;
  src: local('Lora Italic'), local('Lora-Italic'), url('https://martinthomson.github.io/rfc-css/fonts/lora-italic-latin-ext.woff2') format('woff2');
  unicode-range: U+0100-024F, U+0259, U+1E00-1EFF, U+2020, U+20A0-20AB, U+20AD-20CF, U+2113, U+2C60-2C7F, U+A720-A7FF;
}

@font-face {
  font-family: 'Lora';
  font-style: italic;
  font-weight: 400;
  font-display: swap;
  src: local('Lora Italic'), local('Lora-Italic'), url('https://martinthomson.github.io/rfc-css/fonts/lora-italic-latin.woff2') format('woff2');
  unicode-range: U+0000-00FF, U+0131, U+0152-0153, U+02BB-02BC, U+02C6, U+02DA, U+02DC, U+2000-206F, U+2074, U+20AC, U+2122, U+2191, U+2193, U+2212, U+2215, U+FEFF, U+FFFD;
}
@font-face {
  font-family: 'Lora';
  font-style: normal;
  font-weight: 400;
  font-display: swap;
  src: local('Lora Regular'), local('Lora-Regular'), url('https://martinthomson.github.io/rfc-css/fonts/lora-regular-cyrillic-ext.woff2') format('woff2');
  unicode-range: U+0460-052F, U+1C80-1C88, U+20B4, U+2DE0-2DFF, U+A640-A69F, U+FE2E-FE2F;
}
@font-face {
  font-family: 'Lora';
  font-style: normal;
  font-weight: 400;
  font-display: swap;
  src: local('Lora Regular'), local('Lora-Regular'), url('https://martinthomson.github.io/rfc-css/fonts/lora-regular-cyrillic.woff2') format('woff2');
  unicode-range: U+0400-045F, U+0490-0491, U+04B0-04B1, U+2116;
}
@font-face {
  font-family: 'Lora';
  font-style: normal;
  font-weight: 400;
  font-display: swap;
  src: local('Lora Regular'), local('Lora-Regular'), url('https://martinthomson.github.io/rfc-css/fonts/lora-regular-vietnamese.woff2') format('woff2');
  unicode-range: U+0102-0103, U+0110-0111, U+1EA0-1EF9, U+20AB;
}
@font-face {
  font-family: 'Lora';
  font-style: normal;
  font-weight: 400;
  font-display: swap;
  src: local('Lora Regular'), local('Lora-Regular'), url('https://martinthomson.github.io/rfc-css/fonts/lora-regular-latin-ext.woff2') format('woff2');
  unicode-range: U+0100-024F, U+0259, U+1E00-1EFF, U+2020, U+20A0-20AB, U+20AD-20CF, U+2113, U+2C60-2C7F, U+A720-A7FF;
}
@font-face {
  font-family: 'Lora';
  font-style: normal;
  font-weight: 400;
  font-display: swap;
  src: local('Lora Regular'), local('Lora-Regular'), url('https://martinthomson.github.io/rfc-css/fonts/lora-regular-latin.woff2') format('woff2');
  unicode-range: U+0000-00FF, U+0131, U+0152-0153, U+02BB-02BC, U+02C6, U+02DA, U+02DC, U+2000-206F, U+2074, U+20AC, U+2122, U+2191, U+2193, U+2212, U+2215, U+FEFF, U+FFFD;
}

@font-face {
  font-family: 'Lora';
  font-style: normal;
  font-weight: 700;
  font-display: swap;
  src: local('Lora Bold'), local('Lora-Bold'), url('https://martinthomson.github.io/rfc-css/fonts/lora-bold-cyrillic-ext.woff2') format('woff2');
  unicode-range: U+0460-052F, U+1C80-1C88, U+20B4, U+2DE0-2DFF, U+A640-A69F, U+FE2E-FE2F;
}
@font-face {
  font-family: 'Lora';
  font-style: normal;
  font-weight: 700;
  font-display: swap;
  src: local('Lora Bold'), local('Lora-Bold'), url('https://martinthomson.github.io/rfc-css/fonts/lora-bold-cyrillic.woff2') format('woff2');
  unicode-range: U+0400-045F, U+0490-0491, U+04B0-04B1, U+2116;
}
@font-face {
  font-family: 'Lora';
  font-style: normal;
  font-weight: 700;
  font-display: swap;
  src: local('Lora Bold'), local('Lora-Bold'), url('https://martinthomson.github.io/rfc-css/fonts/lora-bold-vietnamese.woff2') format('woff2');
  unicode-range: U+0102-0103, U+0110-0111, U+1EA0-1EF9, U+20AB;
}
@font-face {
  font-family: 'Lora';
  font-style: normal;
  font-weight: 700;
  font-display: swap;
  src: local('Lora Bold'), local('Lora-Bold'), url('https://martinthomson.github.io/rfc-css/fonts/lora-bold-latin-ext.woff2') format('woff2');
  unicode-range: U+0100-024F, U+0259, U+1E00-1EFF, U+2020, U+20A0-20AB, U+20AD-20CF, U+2113, U+2C60-2C7F, U+A720-A7FF;
}
@font-face {
  font-family: 'Lora';
  font-style: normal;
  font-weight: 700;
  font-display: swap;
  src: local('Lora Bold'), local('Lora-Bold'), url('https://martinthomson.github.io/rfc-css/fonts/lora-bold-latin.woff2') format('woff2');
  unicode-range: U+0000-00FF, U+0131, U+0152-0153, U+02BB-02BC, U+02C6, U+02DA, U+02DC, U+2000-206F, U+2074, U+20AC, U+2122, U+2191, U+2193, U+2212, U+2215, U+FEFF, U+FFFD;
}
@font-face {
  font-family: 'Lora';
  font-style: normal;
  font-weight: 600;
  font-display: swap;
  src: local('Lora SemiBold'), local('Lora-SemiBold'), url('https://martinthomson.github.io/rfc-css/fonts/lora-semibold-latin.woff2') format('woff2');
  unicode-range: U+0000-00FF, U+0131, U+0152-0153, U+02BB-02BC, U+02C6, U+02DA, U+02DC, U+2000-206F, U+2074, U+20AC, U+2122, U+2191, U+2193, U+2212, U+2215, U+FEFF, U+FFFD;
}

@font-face {
  font-family: 'Cabin Condensed';
  font-style: normal;
  font-weight: 600;
  font-display: swap;
  src: local('Cabin Condensed SemiBold'), local('CabinCondensed-SemiBold'), url('https://martinthomson.github.io/rfc-css/fonts/cabincondensed-semibold-vietnamese.woff2') format('woff2');
  unicode-range: U+0102-0103, U+0110-0111, U+1EA0-1EF9, U+20AB;
}
@font-face {
  font-family: 'Cabin Condensed';
  font-style: normal;
  font-weight: 600;
  font-display: swap;
  src: local('Cabin Condensed SemiBold'), local('CabinCondensed-SemiBold'), url('https://martinthomson.github.io/rfc-css/fonts/cabincondensed-semibold-latin-ext.woff2') format('woff2');
  unicode-range: U+0100-024F, U+0259, U+1E00-1EFF, U+2020, U+20A0-20AB, U+20AD-20CF, U+2113, U+2C60-2C7F, U+A720-A7FF;
}
@font-face {
  font-family: 'Cabin Condensed';
  font-style: normal;
  font-weight: 600;
  font-display: swap;
  src: local('Cabin Condensed SemiBold'), local('CabinCondensed-SemiBold'), url('https://martinthomson.github.io/rfc-css/fonts/cabincondensed-semibold-latin.woff2') format('woff2');
  unicode-range: U+0000-00FF, U+0131, U+0152-0153, U+02BB-02BC, U+02C6, U+02DA, U+02DC, U+2000-206F, U+2074, U+20AC, U+2122, U+2191, U+2193, U+2212, U+2215, U+FEFF, U+FFFD;
}

@font-face {
  font-family: 'Oxygen Mono';
  font-style: normal;
  font-weight: 400;
  font-display: swap;
  src: local('Oxygen Mono'), local('OxygenMono-Regular'), url('https://martinthomson.github.io/rfc-css/fonts/oxygenmono-regular-latin-ext.woff2') format('woff2');
  unicode-range: U+0100-024F, U+0259, U+1E00-1EFF, U+2020, U+20A0-20AB, U+20AD-20CF, U+2113, U+2C60-2C7F, U+A720-A7FF;
}
@font-face {
  font-family: 'Oxygen Mono';
  font-style: normal;
  font-weight: 400;
  font-display: swap;
  src: local('Oxygen Mono'), local('OxygenMono-Regular'), url('https://martinthomson.github.io/rfc-css/fonts/oxygenmono-regular-latin.woff2') format('woff2');
  unicode-range: U+0000-00FF, U+0131, U+0152-0153, U+02BB-02BC, U+02C6, U+02DA, U+02DC, U+2000-206F, U+2074, U+20AC, U+2122, U+2191, U+2193, U+2212, U+2215, U+FEFF, U+FFFD;
}

:root {
  color-scheme: light dark;
  --background-color: #fff;
  --text-color: #222;
  --title-color: #191919;
  --link-color: #2a6496;
  --highlight-color: #f9f9f9;
  --line-color: #eee;
  --pilcrow-weak: #ddd;
  --pilcrow-strong: #bbb;
  --small-font-size: 14.5px;
  --font-mono: 'Oxygen Mono', monospace;
  scrollbar-color: #bbb #eee;
}
body {
  max-width: 600px;
  margin: 75px auto;
  padding: 0 5px;
  color: var(--text-color);
  background-color: var(--background-color);
  font: 16px/22px "Lora", serif;
  scroll-behavior: smooth;
}

.ears {
  display: none;
}

/* headings */
h1, h2, h3, h4, h5, h6 {
  font-family: "Cabin Condensed", sans-serif;
  font-weight: 600;
  margin: 0.8em 0 0.3em;
  font-size-adjust: 0.5;
  color: var(--title-color);
}
h1#title {
  font-size: 32px;
  line-height: 40px;
  clear: both;
}
h1#title, h1#rfcnum {
  margin: 1.5em 0 0.2em;
}
h1#rfcnum + h1#title {
  margin: 0.2em 0;
}

h1, h2, h3 {
  font-size: 22px;
  line-height: 27px;
}
h4, h5, h6 {
  font-size: 20px;
  line-height: 24px;
}

/* general structure */
.author {
  padding-bottom: 0.3em;
}
#abstract+p {
  font-size: 18px;
  line-height: 24px;
}
#abstract+p code, #abstract+p samp, #abstract+p tt {
  font-size: 16px;
  line-height: 0;
}

p {
  padding: 0;
  margin: 0.5em 0;
  text-align: left;
}
div {
  margin: 0;
}
.alignRight.art-text {
  background-color: var(--highlight-color);
  border: 1px solid var(--line-color);
  border-radius: 3px;
  padding: 0.5em 1em 0;
  margin-bottom: 0.5em;
}
.alignRight.art-text pre {
  padding: 0;
  width: auto;
}
.alignRight {
  margin: 1em 0;
}
.alignRight > *:first-child {
  border: none;
  margin: 0;
  float: right;
  clear: both;
}
.alignRight > *:nth-child(2) {
  clear: both;
  display: block;
  border: none;
}
svg {
  display: block;
}
/* font-family isn't space-separated, but =~ will have to do */
svg[font-family~="monospace" i], svg [font-family~="monospace" i] {
  font-family: var(--font-mono);
}
.alignCenter.art-text {
  background-color: var(--highlight-color);
  border: 1px solid var(--line-color);
  border-radius: 3px;
  padding: 0.5em 1em 0;
  margin-bottom: 0.5em;
}
.alignCenter.art-text pre {
  padding: 0;
  width: auto;
}
.alignCenter {
  margin: 1em 0;
}
.alignCenter > *:first-child {
  border: none;
  /* this isn't optimal, but it's an existence proof.  PrinceXML doesn't
     support flexbox yet.
  */
  display: table;
  margin: 0 auto;
}

/* lists */
ol, ul {
  padding: 0;
  margin: 0 0 0.5em 2em;
}
:is(ol, ul) :is(ol, ul) {
  margin-left: 1em;
}
li {
  margin: 0 0 0.25em 0;
}
.ulCompact li {
  margin: 0;
}
ul.empty, .ulEmpty {
  list-style-type: none;
}
ul.empty li, .ulEmpty li {
  margin-top: 0.5em;
}
:is(ul, ol).compact, .ulCompact, .olCompact {
  line-height: 1;
  margin: 0 0 0 2em;
}

/* definition lists */
dl {
  clear: left;
  --indent: 3ch;
  /* --indent: attr(indent ch); not supported in any browser, but we can dream */
}
dl.olPercent {
  --indent: 5ch;
}
dl > dt {
  float: left;
  margin-right: 2ch;
  min-width: 8ch;
}
dl.dlNewline > dt {
  float: none;
}
dl > dd {
  margin-bottom: .8em;
  margin-left: var(--indent) !important; /* stupid element overrides */
  min-height: 2ex;
}
dl.olPercent > dt {
  min-width: calc(var(--indent) - 2ch);
}
:is(dl.compact, .dlCompact) > dd {
  margin-bottom: 0;
}
:is(dl.compact, .dlCompact) > dd > :is(:first-child, .break:first-child + *) {
  margin-top: 0;
}
:is(dl.compact, .dlCompact) > dd > :is(:last-child) {
  margin-bottom: 0;
}
dl > dd > dl {
  margin-top: 0.5em;
  margin-bottom: 0;
}
:is(dd, span).break {
  display: none;
}

/* links */
a, a[href].selfRef:hover {
  text-decoration: none;
}
a[href] {
  color: var(--link-color);
}
a[href].selfRef, .iref + a[href].internal {
  color: var(--text-color);
}
a[href]:hover {
  text-decoration: underline;
}
a[href].selfRef:hover {
  background-color: var(--highlight-color);
}
a.xref:is(.cite, .auto), :is(#status-of-memo, #copyright) a {
  white-space: nowrap;
}

/* Figures */
tt, code, pre {
  background-color: var(--highlight-color);
  font: 14px/22px var(--font-mono);
}
tt, code {
  /* changing the font for inline elements leads to different ascender
     and descender heights; as we want to retain baseline alignment,
     remove leading to avoid altering the final height of lines
     note: this fails if these blocks take an entire line,
     a different solution would be great */
  line-height: 0;
}
:is(h1, h2, h3, h4, h5, h6) :is(tt, code) {
  font-size: 84%;
}
pre {
  border: 1px solid var(--line-color);
  font-size: 13.5px;
  line-height: 16px;
  letter-spacing: -0.2px;
  margin: 5px;
  padding: 5px;
}
img {
  max-width: 100%;
}
figure {
  margin: 0.5em 0;
  padding: 0;
}
figure blockquote {
  margin: 0.8em 0.4em 0.4em;
}
figcaption, caption {
  font-style: italic;
  margin: 0.5em 1.5em;
  text-align: left;
}
@media screen {
  /* Auto-collapse boilerplate. */
  :is(#status-of-memo, #copyright) p {
    margin: -2px 0;
    max-height: 0;
    transition: max-height 2s ease, margin 0.5s ease 0.5s;
    overflow: hidden;
  }
  :is(#status-of-memo, #copyright):hover p,
  :is(#status-of-memo, #copyright) h2:target ~ p {
    margin: 0.5em 0;
    max-height: 500px;
    overflow: auto;
  }
  pre, svg {
    display: inline-block;
    overflow-x: auto;
  }
  pre {
    max-width: 100%;
    width: calc(100% - 22px - 1em);
  }
  svg {
    max-width: calc(100% - 22px - 1em);
  }
  figure pre {
    display: block;
    width: calc(100% - 25px);
  }
  :is(pre, svg) + .pilcrow {
    display: inline-block;
    vertical-align: text-bottom;
    padding-bottom: 8px;
  }
}

/* aside, blockquote */
aside, blockquote {
  margin-left: 0;
  padding: 0 2em;
  font-style: italic;
}
blockquote {
  margin: 1em 0;
}
cite {
  display: block;
  text-align: right;
  font-style: italic;
}

/* tables */
table {
  max-width: 100%;
  margin: 0 0 1em;
  border-collapse: collapse;
}
table.right {
  margin-left: auto;
}
table.center {
  margin-left: auto;
  margin-right: auto;
}
table.left {
  margin-right: auto;
}
thead, tbody {
  border: 1px solid var(--line-color);
}
th, td {
  text-align: left;
  vertical-align: top;
  padding: 5px 10px;
}
th {
  background-color: var(--line-color);
}
:is(tr:nth-child(2n), thead+tbody > tr:nth-child(2n+1)) > td {
  background-color: var(--background-color);
}
:is(tr:nth-child(2n+1), thead+tbody > tr:nth-child(2n)) > td {
  background-color: var(--highlight-color);
}
table caption {
  margin: 0;
  padding: 3px 0 3px 1em;
}
table p {
  margin: 0;
}

/* pilcrow */
a.pilcrow {
  margin-left: 3px;
  opacity: 0.2;
  user-select: none;
}
a.pilcrow[href] { color: var(--pilcrow-weak); }
a.pilcrow[href]:hover { text-decoration: none; }
@media not print {
  :hover > a.pilcrow {
    opacity: 1;
  }
  a.pilcrow[href]:hover {
    color: var(--pilcrow-strong);
    background-color: transparent;
  }
}
@media print {
  a.pilcrow {
    display: none;
  }
}

/* misc */
hr {
  border: 0;
  border-top: 1px solid var(--line-color);
}
.bcp14 {
  font-variant: small-caps;
  font-weight: 600;
  font-size: var(--small-font-size);
}
.role {
  font-variant: all-small-caps;
}
sub, sup {
  line-height: 1;
  font-size: 80%;
}

/* info block */
#identifiers {
  margin: 0;
  font-size: var(--small-font-size);
  line-height: 18px;
  --identifier-width: 15ch;
}
#identifiers dt {
  width: var(--identifier-width);
  min-width: var(--identifier-width);
  clear: left;
  float: left;
  text-align: right;
  margin-right: 1ch;
}
#identifiers dd {
  margin: 0;
  margin-left: calc(1em + var(--identifier-width)) !important;
  min-width: 5em;
}
#identifiers .authors .author {
  display: inline-block;
  margin-right: 1.5em;
}
#identifiers .authors .org {
  font-style: italic;
}

/* The prepared/rendered info at the very bottom of the page */
.docInfo {
  color: #999;
  font-size: 0.9em;
  font-style: italic;
  margin-top: 2em;
}
.docInfo .prepared {
  float: left;
}
.docInfo .prepared {
  float: right;
}

/* table of contents */
#toc {
  padding: 0.75em 0 2em 0;
  margin-bottom: 1em;
}
#toc nav ul {
  margin: 0 0.5em 0 0;
  padding: 0;
  list-style: none;
}
#toc nav li {
  line-height: 1.3em;
  margin: 2px 0;
  padding-left: 1.2em;
  text-indent: -1.2em;
}
#toc a.xref {
  white-space: normal;
}
/* references */
.references dt {
  text-align: right;
  font-weight: bold;
  min-width: 10ch;
  margin-right: 1.5ch;
}
.references dt:target::before {
  content: "⇒";
  width: 15px;
  margin: 0 10px 0 -25px;
}
.references dd {
  margin-left: 12ch !important;
  overflow: auto;
}

.refInstance {
  margin-bottom: 1.25em;
}

.references .ascii {
  margin-bottom: 0.25em;
}

/* index */
#rfc\.index\.index + ul {
  margin-left: 0;
}

/* authors */
address.vcard {
  font-style: normal;
  margin: 1em 0;
}
address.vcard .nameRole {
  font-weight: 700;
  margin-left: 0;
}
address.vcard .label {
  margin: 0.5em 0;
}
address.vcard .type {
  display: none;
}
.alternative-contact {
  margin: 1.5em 0 1em;
}
hr.addr {
  border-top: 1px dashed;
  margin: 0;
  color: #ddd;
  max-width: calc(100% - 16px);
}
@media (min-width: 500px) {
  #authors-addresses > section {
    column-count: 2;
    column-gap: 20px;
  }
  #authors-addresses > section > h2 {
    column-span: all;
  }
  /* hack for break-inside: avoid-column */
  #authors-addresses address {
    display: inline-block;
    break-inside: avoid-column;
  }
}

.rfcEditorRemove p:first-of-type {
  font-style: italic;
}
.cref {
  background-color: rgba(249, 232, 105, 0.3);
  padding: 2px 4px;
}
.crefSource {
  font-style: italic;
}
/* alternative layout for smaller screens */
@media screen and (max-width: 929px) {
  #toc {
    position: fixed;
    z-index: 2;
    top: 0;
    right: 0;
    padding: 1px 0 0 0;
    margin: 0;
    border-bottom: 1px solid #ccc;
    opacity: 0.6;
  }
  #toc.active {
      opacity: 1;
  }
  #toc h2 {
    margin: 0;
    padding: 2px 0 2px 6px;
    padding-right: 1em;
    font-size: 18px;
    line-height: 24px;
    min-width: 190px;
    text-align: right;
    background-color: #444;
    color: white;
    cursor: pointer;
  }
  #toc h2::before { /* css hamburger */
    float: right;
    position: relative;
    width: 1em;
    height: 1px;
    left: -164px;
    margin: 8px 0 0 0;
    background: white none repeat scroll 0 0;
    box-shadow: 0 4px 0 0 white, 0 8px 0 0 white;
    content: "";
  }
  #toc nav {
    display: none;
    background-color: var(--background-color);
    padding: 0.5em 1em 1em;
    overflow: auto;
    overscroll-behavior: contain;
    height: calc(100vh - 48px);
    border-left: 1px solid #ddd;
  }
  #toc.active nav {
    display: block;
  }
  /* Make the collapsed ToC header render white on gray also when it's a link */
  #toc h2 a,
  #toc h2 a:link,
  #toc h2 a:focus,
  #toc h2 a:hover,
  #toc a.toplink,
  #toc a.toplink:hover {
    color: white;
    background-color: #444;
    text-decoration: none;
  }
  #toc a.toplink {
    margin-top: 2px;
  }
}

/* alternative layout for wide screens */
@media screen and (min-width: 930px) {
  body {
    padding-right: 360px;
    padding-right: calc(min(180px + 20%, 500px));
  }
  #toc {
    position: fixed;
    bottom: 0;
    right: 0;
    right: calc(50vw - 480px);
    width: 312px;
    margin: 0;
    padding: 0;
    z-index: 1;
  }
  #toc h2 {
    margin: 0;
    padding: 0.25em 1em 1em 0;
  }
  #toc nav {
    display: block;
    height: calc(90vh - 84px);
    bottom: 0;
    padding: 0.5em 0 2em;
    overflow: auto;
    overscroll-behavior: contain;
    scrollbar-width: thin;
  }
  #toc nav > ul  {
    margin-bottom: 2em;
  }
  #toc ul {
    margin: 0 0 0 4px;
    font-size: var(--small-font-size);
  }
  #toc ul :is(p, li) {
    margin: 2px 0;
    line-height: 22px;
  }
  img { /* future proofing */
    max-width: 100%;
    height: auto;
  }
}

/* pagination */
@media print {
  body {
    width: 100%;
  }
  p {
    orphans: 3;
    widows: 3;
  }
  #n-copyright-notice {
    border-bottom: none;
  }
  #toc, #n-introduction {
    page-break-before: always;
  }
  #toc {
    border-top: none;
    padding-top: 0;
  }
  figure, pre, .vcard {
    page-break-inside: avoid;
  }
  h1, h2, h3, h4, h5, h6 {
    page-break-after: avoid;
  }
  :is(h2, h3, h4, h5, h6)+*, dd {
    page-break-before: avoid;
  }
  pre {
    white-space: pre-wrap;
    word-wrap: break-word;
    font-size: 10pt;
  }
  table {
    border: 1px solid #ddd;
  }
  td {
    border-top: 1px solid #ddd;
  }
  .toplink {
    display: none;
  }
}

@page :first {
  padding-top: 0;
  @top-left {
    content: normal;
    border: none;
  }
  @top-center {
    content: normal;
    border: none;
  }
  @top-right {
    content: normal;
    border: none;
  }
}

@page {
  size: A4;
  margin-bottom: 45mm;
  padding-top: 20px;
}

/* Changes introduced to fix issues found during implementation */

/* Separate body from document info even without intervening H1 */
section {
  clear: both;
}

/* Top align author divs, to avoid names without organization dropping level with org names */
.author {
  vertical-align: top;
}

/* Style section numbers with more space between number and title */
.section-number {
  padding-right: 0.5em;
}

/* Add styling for a link in the ToC that points to the top of the document */
a.toplink {
  float: right;
  margin: 8px 0.5em 0;
}

/* Provide styling for table cell text alignment */
table .text-left {
  text-align: left;
}
table .text-center {
  text-align: center;
}
table .text-right {
  text-align: right;
}

/* Make the alternative author contact information look less like just another
   author, and group it closer with the primary author contact information */
.alternative-contact {
  margin: 0.5em 0 0.25em 0;
}
address .non-ascii {
  margin: 0 0 0 2em;
}

/* With it being possible to set tables with alignment
  left, center, and right, { width: 100%; } does not make sense */
table {
  width: auto;
}

/* Avoid reference text that sits in a block with very wide left margin,
   because of a long floating dt label.*/
.references dd {
  overflow: visible;
}

/* Control caption placement */
caption {
  caption-side: bottom;
}

/* Limit the width of the author address vcard, so names in right-to-left
   script don't end up on the other side of the page. */

address.vcard {
  max-width: 20em;
  margin-right: auto;
}

/* For address alignment dependent on LTR or RTL scripts */
address div.left {
  text-align: left;
}
address div.right {
  text-align: right;
}

/* Dark mode. */
@media (prefers-color-scheme: dark) {
:root {
  --background-color: #121212;
  --text-color: #f0f0f0;
  --title-color: #fff;
  --link-color: #4da4f0;
  --highlight-color: #282828;
  --line-color: #444;
  --pilcrow-weak: #444;
  --pilcrow-strong: #666;
  scrollbar-color: #777 #333;
}
}

/* SVG Trick: a prefix match works because only black and white are allowed */
svg :is([stroke="black"], [stroke^="#000"]) {
  stroke: var(--text-color);
}
svg :is([stroke="white"], [stroke^="#fff"]) {
  stroke: var(--background-color);
}
svg :is([fill="black"], [fill^="#000"], :not([fill])) {
  fill: var(--text-color);
}
svg :is([fill="white"], [fill^="#fff"]) {
  fill: var(--background-color);
}
</style>

</head>
<body class="xml2rfc">
<table class="ears">
<thead><tr>
<td class="left">Internet-Draft</td>
<td class="center">DNSCrypt</td>
<td class="right">February 2024</td>
</tr></thead>
<tfoot><tr>
<td class="left">Denis</td>
<td class="center">Expires 10 August 2024</td>
<td class="right">[Page]</td>
</tr></tfoot>
</table>
<div id="external-metadata" class="document-information"></div>
<div id="internal-metadata" class="document-information">
<dl id="identifiers">
<dt class="label-workgroup">Workgroup:</dt>
<dd class="workgroup">Network Working Group</dd>
<dt class="label-internet-draft">Internet-Draft:</dt>
<dd class="internet-draft">draft-denis-dprive-dnscrypt-latest</dd>
<dt class="label-published">Published:</dt>
<dd class="published">
<time datetime="2024-02-07" class="published">7 February 2024</time>
    </dd>
<dt class="label-intended-status">Intended Status:</dt>
<dd class="intended-status">Informational</dd>
<dt class="label-expires">Expires:</dt>
<dd class="expires"><time datetime="2024-08-10">10 August 2024</time></dd>
<dt class="label-authors">Author:</dt>
<dd class="authors">
<div class="author">
      <div class="author-name">F. Denis</div>
<div class="org">Individual Contributor</div>
</div>
</dd>
</dl>
</div>
<h1 id="title">The DNSCrypt protocol</h1>
<section id="section-abstract">
      <h2 id="abstract"><a href="#abstract" class="selfRef">Abstract</a></h2>
<p id="section-abstract-1">The DNSCrypt protocol is designed to encrypt and authenticate DNS traffic between clients and resolvers. This document specifies the protocol and its implementation.<a href="#section-abstract-1" class="pilcrow">¶</a></p>
</section>
<section class="note rfcEditorRemove" id="section-note.1">
      <h2 id="name-about-this-document">
<a href="#name-about-this-document" class="section-name selfRef">About This Document</a>
      </h2>
<p id="section-note.1-1">This note is to be removed before publishing as an RFC.<a href="#section-note.1-1" class="pilcrow">¶</a></p>
<p id="section-note.1-2">
        Status information for this document may be found at <span><a href="https://datatracker.ietf.org/doc/draft-denis-dprive-dnscrypt/">https://datatracker.ietf.org/doc/draft-denis-dprive-dnscrypt/</a></span>.<a href="#section-note.1-2" class="pilcrow">¶</a></p>
<p id="section-note.1-3">Source for this draft and an issue tracker can be found at
        <span><a href="https://github.com/DNSCrypt/dnscrypt-protocol">https://github.com/DNSCrypt/dnscrypt-protocol</a></span>.<a href="#section-note.1-3" class="pilcrow">¶</a></p>
</section>
<div id="status-of-memo">
<section id="section-boilerplate.1">
        <h2 id="name-status-of-this-memo">
<a href="#name-status-of-this-memo" class="section-name selfRef">Status of This Memo</a>
        </h2>
<p id="section-boilerplate.1-1">
        This Internet-Draft is submitted in full conformance with the
        provisions of BCP 78 and BCP 79.<a href="#section-boilerplate.1-1" class="pilcrow">¶</a></p>
<p id="section-boilerplate.1-2">
        Internet-Drafts are working documents of the Internet Engineering Task
        Force (IETF). Note that other groups may also distribute working
        documents as Internet-Drafts. The list of current Internet-Drafts is
        at <span><a href="https://datatracker.ietf.org/drafts/current/">https://datatracker.ietf.org/drafts/current/</a></span>.<a href="#section-boilerplate.1-2" class="pilcrow">¶</a></p>
<p id="section-boilerplate.1-3">
        Internet-Drafts are draft documents valid for a maximum of six months
        and may be updated, replaced, or obsoleted by other documents at any
        time. It is inappropriate to use Internet-Drafts as reference
        material or to cite them other than as "work in progress."<a href="#section-boilerplate.1-3" class="pilcrow">¶</a></p>
<p id="section-boilerplate.1-4">
        This Internet-Draft will expire on 10 August 2024.<a href="#section-boilerplate.1-4" class="pilcrow">¶</a></p>
</section>
</div>
<div id="copyright">
<section id="section-boilerplate.2">
        <h2 id="name-copyright-notice">
<a href="#name-copyright-notice" class="section-name selfRef">Copyright Notice</a>
        </h2>
<p id="section-boilerplate.2-1">
            Copyright (c) 2024 IETF Trust and the persons identified as the
            document authors. All rights reserved.<a href="#section-boilerplate.2-1" class="pilcrow">¶</a></p>
<p id="section-boilerplate.2-2">
            This document is subject to BCP 78 and the IETF Trust's Legal
            Provisions Relating to IETF Documents
            (<span><a href="https://trustee.ietf.org/license-info">https://trustee.ietf.org/license-info</a></span>) in effect on the date of
            publication of this document. Please review these documents
            carefully, as they describe your rights and restrictions with
            respect to this document.<a href="#section-boilerplate.2-2" class="pilcrow">¶</a></p>
</section>
</div>
<div id="toc">
<section id="section-toc.1">
        <a href="#" onclick="scroll(0,0)" class="toplink">▲</a><h2 id="name-table-of-contents">
<a href="#name-table-of-contents" class="section-name selfRef">Table of Contents</a>
        </h2>
<nav class="toc"><ul class="compact toc ulBare ulEmpty">
<li class="compact toc ulBare ulEmpty" id="section-toc.1-1.1">
            <p id="section-toc.1-1.1.1" class="keepWithNext"><a href="#section-1" class="auto internal xref">1</a>.  <a href="#name-introduction" class="internal xref">Introduction</a></p>
</li>
          <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.2">
            <p id="section-toc.1-1.2.1" class="keepWithNext"><a href="#section-2" class="auto internal xref">2</a>.  <a href="#name-conventions-and-definitions" class="internal xref">Conventions And Definitions</a></p>
</li>
          <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.3">
            <p id="section-toc.1-1.3.1" class="keepWithNext"><a href="#section-3" class="auto internal xref">3</a>.  <a href="#name-protocol-overview" class="internal xref">Protocol Overview</a></p>
</li>
          <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.4">
            <p id="section-toc.1-1.4.1"><a href="#section-4" class="auto internal xref">4</a>.  <a href="#name-key-management" class="internal xref">Key Management</a></p>
</li>
          <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.5">
            <p id="section-toc.1-1.5.1"><a href="#section-5" class="auto internal xref">5</a>.  <a href="#name-session-establishment" class="internal xref">Session Establishment</a></p>
</li>
          <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.6">
            <p id="section-toc.1-1.6.1"><a href="#section-6" class="auto internal xref">6</a>.  <a href="#name-transport" class="internal xref">Transport</a></p>
</li>
          <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.7">
            <p id="section-toc.1-1.7.1"><a href="#section-7" class="auto internal xref">7</a>.  <a href="#name-padding-for-client-queries-" class="internal xref">Padding For Client Queries Over UDP</a></p>
</li>
          <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.8">
            <p id="section-toc.1-1.8.1"><a href="#section-8" class="auto internal xref">8</a>.  <a href="#name-client-queries-over-udp" class="internal xref">Client Queries Over UDP</a></p>
</li>
          <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.9">
            <p id="section-toc.1-1.9.1"><a href="#section-9" class="auto internal xref">9</a>.  <a href="#name-padding-for-client-queries-o" class="internal xref">Padding For Client Queries Over TCP</a></p>
</li>
          <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.10">
            <p id="section-toc.1-1.10.1"><a href="#section-10" class="auto internal xref">10</a>. <a href="#name-client-queries-over-tcp" class="internal xref">Client Queries Over TCP</a></p>
</li>
          <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.11">
            <p id="section-toc.1-1.11.1"><a href="#section-11" class="auto internal xref">11</a>. <a href="#name-authenticated-encryption-an" class="internal xref">Authenticated Encryption And Key Exchange Algorithm</a></p>
</li>
          <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.12">
            <p id="section-toc.1-1.12.1"><a href="#section-12" class="auto internal xref">12</a>. <a href="#name-certificates" class="internal xref">Certificates</a></p>
</li>
          <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.13">
            <p id="section-toc.1-1.13.1"><a href="#section-13" class="auto internal xref">13</a>. <a href="#name-implementation-status" class="internal xref">Implementation Status</a></p>
</li>
          <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.14">
            <p id="section-toc.1-1.14.1"><a href="#section-14" class="auto internal xref">14</a>. <a href="#name-security-considerations" class="internal xref">Security Considerations</a></p>
</li>
          <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.15">
            <p id="section-toc.1-1.15.1"><a href="#section-15" class="auto internal xref">15</a>. <a href="#name-operational-considerations" class="internal xref">Operational Considerations</a></p>
</li>
          <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.16">
            <p id="section-toc.1-1.16.1"><a href="#section-16" class="auto internal xref">16</a>. <a href="#name-iana-considerations" class="internal xref">IANA Considerations</a></p>
</li>
          <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.17">
            <p id="section-toc.1-1.17.1"><a href="#section-17" class="auto internal xref">17</a>. <a href="#name-appendix-1-the-box-xchachap" class="internal xref">Appendix 1: The Box-XChaChaPoly Algorithm</a></p>
<ul class="compact toc ulBare ulEmpty">
<li class="compact toc ulBare ulEmpty" id="section-toc.1-1.17.2.1">
                <p id="section-toc.1-1.17.2.1.1"><a href="#section-17.1" class="auto internal xref">17.1</a>.  <a href="#name-hchacha20" class="internal xref">HChaCha20</a></p>
</li>
              <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.17.2.2">
                <p id="section-toc.1-1.17.2.2.1"><a href="#section-17.2" class="auto internal xref">17.2</a>.  <a href="#name-test-vector-for-the-hchacha" class="internal xref">Test Vector For The HChaCha20 Block Function</a></p>
</li>
              <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.17.2.3">
                <p id="section-toc.1-1.17.2.3.1"><a href="#section-17.3" class="auto internal xref">17.3</a>.  <a href="#name-chacha20_djb" class="internal xref">ChaCha20_DJB</a></p>
</li>
              <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.17.2.4">
                <p id="section-toc.1-1.17.2.4.1"><a href="#section-17.4" class="auto internal xref">17.4</a>.  <a href="#name-xchacha20_djb" class="internal xref">XChaCha20_DJB</a></p>
</li>
              <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.17.2.5">
                <p id="section-toc.1-1.17.2.5.1"><a href="#section-17.5" class="auto internal xref">17.5</a>.  <a href="#name-xchacha20_djb-poly1305" class="internal xref">XChaCha20_DJB-Poly1305</a></p>
</li>
              <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.17.2.6">
                <p id="section-toc.1-1.17.2.6.1"><a href="#section-17.6" class="auto internal xref">17.6</a>.  <a href="#name-the-box-xchachapoly-algorit" class="internal xref">The Box-XChaChaPoly Algorithm</a></p>
</li>
            </ul>
</li>
          <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.18">
            <p id="section-toc.1-1.18.1"><a href="#section-18" class="auto internal xref">18</a>. <a href="#name-normative-references" class="internal xref">Normative References</a></p>
</li>
          <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.19">
            <p id="section-toc.1-1.19.1"><a href="#appendix-A" class="auto internal xref"></a><a href="#name-authors-address" class="internal xref">Author's Address</a></p>
</li>
        </ul>
</nav>
</section>
</div>
<div id="introduction">
<section id="section-1">
      <h2 id="name-introduction">
<a href="#section-1" class="section-number selfRef">1. </a><a href="#name-introduction" class="section-name selfRef">Introduction</a>
      </h2>
<p id="section-1-1">The document defines the DNSCrypt protocol, which encrypts and authenticates DNS <span>[<a href="#RFC1035" class="cite xref">RFC1035</a>]</span> queries and responses, improving confidentiality, integrity, and resistance to attacks affecting the original DNS protocol.<a href="#section-1-1" class="pilcrow">¶</a></p>
<p id="section-1-2">The protocol is designed to be lightweight, extensible, and simple to implement securely on top of an existing DNS client, server or proxy.<a href="#section-1-2" class="pilcrow">¶</a></p>
<p id="section-1-3">DNS packets do not need to be parsed or rewritten. DNSCrypt simply wraps them in a secure, encrypted container. Encrypted packets are then exchanged the same way as regular packets, using the standard DNS transport mechanisms. Queries and responses are sent over UDP, falling back to TCP for large responses only if necessary.<a href="#section-1-3" class="pilcrow">¶</a></p>
<p id="section-1-4">DNSCrypt is stateless. Every query can be processed independently from other queries. There are no session identifiers. In order to better defend against fingerprinting, clients can replace their keys whenever they want, without extra interactions with servers.<a href="#section-1-4" class="pilcrow">¶</a></p>
<p id="section-1-5">DNSCrypt packets can securely be proxied without having to be decrypted, allowing client IP addresses to be hidden from resolvers ("Anonymized DNSCrypt").<a href="#section-1-5" class="pilcrow">¶</a></p>
<p id="section-1-6">Recursive DNS servers can accept DNSCrypt queries on the same IP address and port used for regular DNS traffic. Similarly, DNSCrypt and DoH can also share the same IP address and TCP port.<a href="#section-1-6" class="pilcrow">¶</a></p>
<p id="section-1-7">Lastly, DNSCrypt mitigates two common security vulnerabilities in regular DNS over UDP: amplification and fragmentation attacks.<a href="#section-1-7" class="pilcrow">¶</a></p>
</section>
</div>
<div id="conventions-and-definitions">
<section id="section-2">
      <h2 id="name-conventions-and-definitions">
<a href="#section-2" class="section-number selfRef">2. </a><a href="#name-conventions-and-definitions" class="section-name selfRef">Conventions And Definitions</a>
      </h2>
<p id="section-2-1">The key words "<span class="bcp14">MUST</span>", "<span class="bcp14">MUST NOT</span>", "<span class="bcp14">REQUIRED</span>", "<span class="bcp14">SHALL</span>", "<span class="bcp14">SHALL NOT</span>", "<span class="bcp14">SHOULD</span>", "<span class="bcp14">SHOULD NOT</span>", "<span class="bcp14">RECOMMENDED</span>", "<span class="bcp14">NOT RECOMMENDED</span>",
"<span class="bcp14">MAY</span>", and "<span class="bcp14">OPTIONAL</span>" in this document are to be interpreted as
described in BCP 14 <span>[<a href="#RFC2119" class="cite xref">RFC2119</a>]</span> <span>[<a href="#RFC8174" class="cite xref">RFC8174</a>]</span> when, and only when, they
appear in all capitals, as shown here.<a href="#section-2-1" class="pilcrow">¶</a></p>
<p id="section-2-2">Definitions for client queries:<a href="#section-2-2" class="pilcrow">¶</a></p>
<ul class="normal">
<li class="normal" id="section-2-3.1">
          <p id="section-2-3.1.1"><code>&lt;dnscrypt-query&gt;</code>:  <code>&lt;client-magic&gt;</code> <code>&lt;client-pk&gt;</code> <code>&lt;client-nonce&gt;</code> <code>&lt;encrypted-query&gt;</code><a href="#section-2-3.1.1" class="pilcrow">¶</a></p>
</li>
        <li class="normal" id="section-2-3.2">
          <p id="section-2-3.2.1"><code>&lt;client-magic&gt;</code>: a 8 byte identifier for the resolver certificate
chosen by the client.<a href="#section-2-3.2.1" class="pilcrow">¶</a></p>
</li>
        <li class="normal" id="section-2-3.3">
          <p id="section-2-3.3.1"><code>&lt;client-pk&gt;</code>: the client's public key, whose length depends on the encryption algorithm defined in the chosen certificate.<a href="#section-2-3.3.1" class="pilcrow">¶</a></p>
</li>
        <li class="normal" id="section-2-3.4">
          <p id="section-2-3.4.1"><code>&lt;client-sk&gt;</code>: the client's secret key.<a href="#section-2-3.4.1" class="pilcrow">¶</a></p>
</li>
        <li class="normal" id="section-2-3.5">
          <p id="section-2-3.5.1"><code>&lt;resolver-pk&gt;</code>: the resolver's public key.<a href="#section-2-3.5.1" class="pilcrow">¶</a></p>
</li>
        <li class="normal" id="section-2-3.6">
          <p id="section-2-3.6.1"><code>&lt;client-nonce&gt;</code>: a unique query identifier for a given (<code>&lt;client-sk&gt;</code>, <code>&lt;resolver-pk&gt;</code>) tuple. The same query sent twice for the same (<code>&lt;client-sk&gt;</code>, <code>&lt;resolver-pk&gt;</code>) tuple <span class="bcp14">MUST</span> use two distinct <code>&lt;client-nonce&gt;</code> values. The length of <code>&lt;client-nonce&gt;</code> is determined by the chosen encryption algorithm.<a href="#section-2-3.6.1" class="pilcrow">¶</a></p>
</li>
        <li class="normal" id="section-2-3.7">
          <p id="section-2-3.7.1"><code>AE</code>: the authenticated encryption function.<a href="#section-2-3.7.1" class="pilcrow">¶</a></p>
</li>
        <li class="normal" id="section-2-3.8">
          <p id="section-2-3.8.1"><code>&lt;encrypted-query&gt;</code>: <code>AE(&lt;shared-key&gt; &lt;client-nonce&gt; &lt;client-nonce-pad&gt;, &lt;client-query&gt; &lt;client-query-pad&gt;)</code><a href="#section-2-3.8.1" class="pilcrow">¶</a></p>
</li>
        <li class="normal" id="section-2-3.9">
          <p id="section-2-3.9.1"><code>&lt;shared-key&gt;</code>: the shared key derived from <code>&lt;resolver-pk&gt;</code> and <code>&lt;client-sk&gt;</code>, using the key exchange algorithm defined in the chosen certificate.
-<code>&lt;client-query&gt;</code>: the unencrypted client query. The query is not modified; in particular, the query flags are not altered and the query length <span class="bcp14">MUST</span> be kept in queries prepared to be sent over TCP.<a href="#section-2-3.9.1" class="pilcrow">¶</a></p>
</li>
        <li class="normal" id="section-2-3.10">
          <p id="section-2-3.10.1"><code>&lt;client-nonce-pad&gt;</code>: <code>&lt;client-nonce&gt;</code> length is half the nonce length required by the encryption algorithm. In client queries, the other half, <code>&lt;client-nonce-pad&gt;</code> is filled with NUL bytes.<a href="#section-2-3.10.1" class="pilcrow">¶</a></p>
</li>
        <li class="normal" id="section-2-3.11">
          <p id="section-2-3.11.1"><code>&lt;client-query-pad&gt;</code>: the variable-length padding.<a href="#section-2-3.11.1" class="pilcrow">¶</a></p>
</li>
      </ul>
<p id="section-2-4">Definitions for server responses:<a href="#section-2-4" class="pilcrow">¶</a></p>
<ul class="normal">
<li class="normal" id="section-2-5.1">
          <p id="section-2-5.1.1"><code>&lt;dnscrypt-response&gt;</code>: <code>&lt;resolver-magic&gt;</code> <code>&lt;nonce&gt;</code> <code>&lt;encrypted-response&gt;</code><a href="#section-2-5.1.1" class="pilcrow">¶</a></p>
</li>
        <li class="normal" id="section-2-5.2">
          <p id="section-2-5.2.1"><code>&lt;resolver-magic&gt;</code>: the <code>0x72 0x36 0x66 0x6e 0x76 0x57 0x6a 0x38</code> byte sequence<a href="#section-2-5.2.1" class="pilcrow">¶</a></p>
</li>
        <li class="normal" id="section-2-5.3">
          <p id="section-2-5.3.1"><code>&lt;nonce&gt;</code>: <code>&lt;client-nonce&gt;</code> <code>&lt;resolver-nonce&gt;</code><a href="#section-2-5.3.1" class="pilcrow">¶</a></p>
</li>
        <li class="normal" id="section-2-5.4">
          <p id="section-2-5.4.1"><code>&lt;client-nonce&gt;</code>: the nonce sent by the client in the related query.<a href="#section-2-5.4.1" class="pilcrow">¶</a></p>
</li>
        <li class="normal" id="section-2-5.5">
          <p id="section-2-5.5.1"><code>&lt;client-pk&gt;</code>: the client's public key.<a href="#section-2-5.5.1" class="pilcrow">¶</a></p>
</li>
        <li class="normal" id="section-2-5.6">
          <p id="section-2-5.6.1"><code>&lt;resolver-sk&gt;</code>: the resolver's secret key.<a href="#section-2-5.6.1" class="pilcrow">¶</a></p>
</li>
        <li class="normal" id="section-2-5.7">
          <p id="section-2-5.7.1"><code>&lt;resolver-nonce&gt;</code>: a unique response identifier for a given <code>(&lt;client-pk&gt;, &lt;resolver-sk&gt;)</code> tuple. The length of <code>&lt;resolver-nonce&gt;</code> depends on the chosen encryption algorithm.<a href="#section-2-5.7.1" class="pilcrow">¶</a></p>
</li>
        <li class="normal" id="section-2-5.8">
          <p id="section-2-5.8.1"><code>DE</code>: the authenticated decryption function.<a href="#section-2-5.8.1" class="pilcrow">¶</a></p>
</li>
        <li class="normal" id="section-2-5.9">
          <p id="section-2-5.9.1"><code>&lt;encrypted-response&gt;</code>: <code>DE(&lt;shared-key&gt;, &lt;nonce&gt;, &lt;resolver-response&gt; &lt;resolver-response-pad&gt;)</code><a href="#section-2-5.9.1" class="pilcrow">¶</a></p>
</li>
        <li class="normal" id="section-2-5.10">
          <p id="section-2-5.10.1"><code>&lt;shared-key&gt;</code>: the shared key derived from <code>&lt;resolver-sk&gt;</code> and <code>&lt;client-pk&gt;</code>, using the key exchange algorithm defined in the chosen certificate.<a href="#section-2-5.10.1" class="pilcrow">¶</a></p>
</li>
        <li class="normal" id="section-2-5.11">
          <p id="section-2-5.11.1"><code>&lt;resolver-response&gt;</code>: the unencrypted resolver response. The response is not modified; in particular, the query flags are not altered and the response length <span class="bcp14">MUST</span> be kept in responses prepared to be sent over TCP.<a href="#section-2-5.11.1" class="pilcrow">¶</a></p>
</li>
        <li class="normal" id="section-2-5.12">
          <p id="section-2-5.12.1"><code>&lt;resolver-response-pad&gt;</code>: the variable-length padding.<a href="#section-2-5.12.1" class="pilcrow">¶</a></p>
</li>
      </ul>
</section>
</div>
<div id="protocol-overview">
<section id="section-3">
      <h2 id="name-protocol-overview">
<a href="#section-3" class="section-number selfRef">3. </a><a href="#name-protocol-overview" class="section-name selfRef">Protocol Overview</a>
      </h2>
<p id="section-3-1">The DNSCrypt protocol operates through the following steps:<a href="#section-3-1" class="pilcrow">¶</a></p>
<ol start="1" type="1" class="normal type-1" id="section-3-2">
<li id="section-3-2.1">
          <p id="section-3-2.1.1">The DNSCrypt client sends a DNS query to a DNSCrypt server to retrieve the server's public keys.<a href="#section-3-2.1.1" class="pilcrow">¶</a></p>
</li>
        <li id="section-3-2.2">
          <p id="section-3-2.2.1">The client generates its own key pair.<a href="#section-3-2.2.1" class="pilcrow">¶</a></p>
</li>
        <li id="section-3-2.3">
          <p id="section-3-2.3.1">The client encrypts unmodified DNS queries using a server's public key, padding them as necessary, and concatenates them to a nonce and a copy of the client's public key. The resulting output is transmitted to the server via standard DNS transport mechanisms.<a href="#section-3-2.3.1" class="pilcrow">¶</a></p>
</li>
        <li id="section-3-2.4">
          <p id="section-3-2.4.1">Encrypted queries are decrypted by the server using the attached client public key and the server's own secret key. The output is a regular DNS packet that doesn't require any special processing.<a href="#section-3-2.4.1" class="pilcrow">¶</a></p>
</li>
        <li id="section-3-2.5">
          <p id="section-3-2.5.1">To send an encrypted response, the server adds padding to the unmodified response, encrypts the result using the client's public key and the client's nonce, and truncates the response if necessary. The resulting packet, truncated or not, is sent to the client using standard DNS mechanisms.<a href="#section-3-2.5.1" class="pilcrow">¶</a></p>
</li>
        <li id="section-3-2.6">
          <p id="section-3-2.6.1">The client authenticates and decrypts the response using its secret key, the server's public key, the client's nonce included in the response, and the client's original nonce. If the response was truncated, the client <span class="bcp14">MAY</span> adjust internal parameters and retry over TCP. If not, the output is a regular DNS response that can be directly forwarded to applications and stub resolvers.<a href="#section-3-2.6.1" class="pilcrow">¶</a></p>
</li>
      </ol>
</section>
</div>
<div id="key-management">
<section id="section-4">
      <h2 id="name-key-management">
<a href="#section-4" class="section-number selfRef">4. </a><a href="#name-key-management" class="section-name selfRef">Key Management</a>
      </h2>
<p id="section-4-1">Both clients and resolvers generate short-term key pairs for each encryption system they support.<a href="#section-4-1" class="pilcrow">¶</a></p>
<p id="section-4-2">Clients generate unique key pairs for each resolver they communicate with, while resolvers create individual key pairs for every client they interact with. Additionally, the resolver creates a public key for each encryption system it supports.<a href="#section-4-2" class="pilcrow">¶</a></p>
</section>
</div>
<div id="session-establishment">
<section id="section-5">
      <h2 id="name-session-establishment">
<a href="#section-5" class="section-number selfRef">5. </a><a href="#name-session-establishment" class="section-name selfRef">Session Establishment</a>
      </h2>
<p id="section-5-1">From the client's perspective, a DNSCrypt session is initiated when the client sends an unauthenticated DNS query to a DNSCrypt-capable resolver. This DNS query contains encoded information about the certificate versions supported by the client and a public identifier of the desired provider.<a href="#section-5-1" class="pilcrow">¶</a></p>
<p id="section-5-2">The resolver sends back a collection of signed certificates that the client <span class="bcp14">MUST</span> verify using the pre-distributed provider public key. Each certificate includes a validity period, a serial number, a version that defines a key exchange mechanism, an authenticated encryption algorithm and its parameters, as well as a short-term public key, known as the resolver public key.<a href="#section-5-2" class="pilcrow">¶</a></p>
<p id="section-5-3">Resolvers have the ability to support various algorithms and can concurrently advertise multiple short-term public keys (resolver public keys). The client picks the one with the highest serial number among the currently valid ones that match a supported protocol version.<a href="#section-5-3" class="pilcrow">¶</a></p>
<p id="section-5-4">Every certificate contains a unique magic number that the client <span class="bcp14">MUST</span> include at the beginning of their queries. This allows the resolver to identify which certificate the client selected for crafting a particular query.<a href="#section-5-4" class="pilcrow">¶</a></p>
<p id="section-5-5">The encryption algorithm, resolver public key, and client magic number from the chosen certificate are then used by the client to send encrypted queries. These queries include the client public key.<a href="#section-5-5" class="pilcrow">¶</a></p>
<p id="section-5-6">With the knowledge of the chosen certificate and corresponding secret key, along with the client's public key, the resolver is able to verify, decrypt the query, and then encrypt the response utilizing identical parameters.<a href="#section-5-6" class="pilcrow">¶</a></p>
</section>
</div>
<div id="transport">
<section id="section-6">
      <h2 id="name-transport">
<a href="#section-6" class="section-number selfRef">6. </a><a href="#name-transport" class="section-name selfRef">Transport</a>
      </h2>
<p id="section-6-1">The DNSCrypt protocol can use the UDP and TCP transport protocols.
DNSCrypt clients and resolvers <span class="bcp14">SHOULD</span> support the protocol via UDP, and <span class="bcp14">MUST</span> support it over TCP.<a href="#section-6-1" class="pilcrow">¶</a></p>
<p id="section-6-2">Both TCP and UDP connections using DNSCrypt <span class="bcp14">SHOULD</span> employ port 443 by default.<a href="#section-6-2" class="pilcrow">¶</a></p>
</section>
</div>
<div id="padding-for-client-queries-over-udp">
<section id="section-7">
      <h2 id="name-padding-for-client-queries-">
<a href="#section-7" class="section-number selfRef">7. </a><a href="#name-padding-for-client-queries-" class="section-name selfRef">Padding For Client Queries Over UDP</a>
      </h2>
<p id="section-7-1">Before encryption takes place, queries are padded according to the ISO/IEC 7816-4 standard. Padding begins with a single byte holding the value <code>0x80</code>, succeeded by any number of <code>NUL</code> bytes.<a href="#section-7-1" class="pilcrow">¶</a></p>
<p id="section-7-2"><code>&lt;client-query&gt;</code> <code>&lt;client-query-pad&gt;</code> <span class="bcp14">MUST</span> be at least <code>&lt;min-query-len&gt;</code> bytes.
In this context, <code>&lt;client-query&gt;</code> represents the original client query, while <code>&lt;client-query-pad&gt;</code> denotes the added padding.<a href="#section-7-2" class="pilcrow">¶</a></p>
<p id="section-7-3">Should the client query's length fall short of  <code>&lt;min-query-len&gt;</code> bytes, the padding length <span class="bcp14">MUST</span> be adjusted in order to satisfy the length requirement.<a href="#section-7-3" class="pilcrow">¶</a></p>
<p id="section-7-4"><code>&lt;min-query-len&gt;</code> is a variable length, initially set to 256 bytes, and <span class="bcp14">MUST</span> be a multiple of 64 bytes. It represents the minimum permitted length for a client query, inclusive of padding.<a href="#section-7-4" class="pilcrow">¶</a></p>
</section>
</div>
<div id="client-queries-over-udp">
<section id="section-8">
      <h2 id="name-client-queries-over-udp">
<a href="#section-8" class="section-number selfRef">8. </a><a href="#name-client-queries-over-udp" class="section-name selfRef">Client Queries Over UDP</a>
      </h2>
<p id="section-8-1">UDP-based client queries need to follow the padding guidelines outlined in section 3.<a href="#section-8-1" class="pilcrow">¶</a></p>
<p id="section-8-2">Each UDP packet <span class="bcp14">MUST</span> hold one query, with the complete content comprising the <code>&lt;dnscrypt-query&gt;</code> structure specified in section 2.<a href="#section-8-2" class="pilcrow">¶</a></p>
<p id="section-8-3">UDP packets employing the DNSCrypt protocol have the capability to be split into distinct IP packets sharing the same source port.<a href="#section-8-3" class="pilcrow">¶</a></p>
<p id="section-8-4">Upon receiving a query, the resolver may choose to either disregard it or send back a response encrypted using DNSCrypt.<a href="#section-8-4" class="pilcrow">¶</a></p>
<p id="section-8-5">The client <span class="bcp14">MUST</span> authenticate and, if authentication succeeds, decrypt the response with the help of the resolver's public key, the shared secret, and the obtained nonce. In case the response fails verification, it <span class="bcp14">MUST</span> be disregarded by the client.<a href="#section-8-5" class="pilcrow">¶</a></p>
<p id="section-8-6">If the response has the TC flag set, the client <span class="bcp14">MUST</span>:<a href="#section-8-6" class="pilcrow">¶</a></p>
<ol start="1" type="1" class="normal type-1" id="section-8-7">
<li id="section-8-7.1">
          <p id="section-8-7.1.1">send the query again using TCP<a href="#section-8-7.1.1" class="pilcrow">¶</a></p>
</li>
        <li id="section-8-7.2">
          <p id="section-8-7.2.1">set the new minimum query length as:<a href="#section-8-7.2.1" class="pilcrow">¶</a></p>
</li>
      </ol>
<p id="section-8-8"><code>&lt;min-query-len&gt; ::= min(&lt;min-query-len&gt; + 64, &lt;max-query-len&gt;)</code><a href="#section-8-8" class="pilcrow">¶</a></p>
<p id="section-8-9"><code>&lt;min-query-len&gt;</code> denotes the minimum permitted length for a client query, including padding. That value <span class="bcp14">MUST</span> be capped so that the full length of a DNSCrypt packet doesn't exceed the maximum size required by the transport layer.<a href="#section-8-9" class="pilcrow">¶</a></p>
<p id="section-8-10">The client <span class="bcp14">MAY</span> decrease <code>&lt;min-query-len&gt;</code>, but the length <span class="bcp14">MUST</span> remain a multiple of 64 bytes.<a href="#section-8-10" class="pilcrow">¶</a></p>
</section>
</div>
<div id="padding-for-client-queries-over-tcp">
<section id="section-9">
      <h2 id="name-padding-for-client-queries-o">
<a href="#section-9" class="section-number selfRef">9. </a><a href="#name-padding-for-client-queries-o" class="section-name selfRef">Padding For Client Queries Over TCP</a>
      </h2>
<p id="section-9-1">Queries <span class="bcp14">MUST</span> undergo padding using the ISO/IEC 7816-4 format before being encrypted. The padding starts with a byte valued <code>0x80</code> followed by a
variable number of NUL bytes.<a href="#section-9-1" class="pilcrow">¶</a></p>
<p id="section-9-2">The length of <code>&lt;client-query-pad&gt;</code> is selected randomly, ranging from 1 to 256 bytes, including the initial byte valued at <code>0x80</code>. The total length of <code>&lt;client-query&gt;</code> <code>&lt;client-query-pad&gt;</code> <span class="bcp14">MUST</span> be a multiple of 64 bytes.<a href="#section-9-2" class="pilcrow">¶</a></p>
<p id="section-9-3">For example, an originally unpadded 56-bytes DNS query can be padded as:<a href="#section-9-3" class="pilcrow">¶</a></p>
<p id="section-9-4"><code>&lt;56-bytes-query&gt; 0x80 0x00 0x00 0x00 0x00 0x00 0x00 0x00</code><a href="#section-9-4" class="pilcrow">¶</a></p>
<p id="section-9-5">or<a href="#section-9-5" class="pilcrow">¶</a></p>
<p id="section-9-6"><code>&lt;56-bytes-query&gt; 0x80 (0x00 * 71)</code><a href="#section-9-6" class="pilcrow">¶</a></p>
<p id="section-9-7">or<a href="#section-9-7" class="pilcrow">¶</a></p>
<p id="section-9-8"><code>&lt;56-bytes-query&gt; 0x80 (0x00 * 135)</code><a href="#section-9-8" class="pilcrow">¶</a></p>
<p id="section-9-9">or<a href="#section-9-9" class="pilcrow">¶</a></p>
<p id="section-9-10"><code>&lt;56-bytes-query&gt; 0x80 (0x00 * 199)</code><a href="#section-9-10" class="pilcrow">¶</a></p>
</section>
</div>
<div id="client-queries-over-tcp">
<section id="section-10">
      <h2 id="name-client-queries-over-tcp">
<a href="#section-10" class="section-number selfRef">10. </a><a href="#name-client-queries-over-tcp" class="section-name selfRef">Client Queries Over TCP</a>
      </h2>
<p id="section-10-1">The sole differences between encrypted client queries transmitted via TCP and those sent using UDP lie in the padding length calculation and the inclusion of a length prefix, represented as two big-endian bytes.<a href="#section-10-1" class="pilcrow">¶</a></p>
<p id="section-10-2">In contrast, cleartext DNS query payloads do not necessitate a length prefix, regardless of whether they are transmitted via TCP.<a href="#section-10-2" class="pilcrow">¶</a></p>
<p id="section-10-3">Unlike UDP queries, a query sent over TCP can be shorter than the response.<a href="#section-10-3" class="pilcrow">¶</a></p>
<p id="section-10-4">After having received a response from the resolver, the client and the resolver <span class="bcp14">MUST</span> close the TCP connection to ensure security and comply with this revision of the protocol, which prohibits multiple transactions over the same TCP connection.<a href="#section-10-4" class="pilcrow">¶</a></p>
</section>
</div>
<div id="authenticated-encryption-and-key-exchange-algorithm">
<section id="section-11">
      <h2 id="name-authenticated-encryption-an">
<a href="#section-11" class="section-number selfRef">11. </a><a href="#name-authenticated-encryption-an" class="section-name selfRef">Authenticated Encryption And Key Exchange Algorithm</a>
      </h2>
<p id="section-11-1">The <code>Box-XChaChaPoly</code> construction, and the way to use it described in this section, <span class="bcp14">MUST</span> be referenced in certificates as version <code>2</code> of the public-key authenticated encryption system.<a href="#section-11-1" class="pilcrow">¶</a></p>
<p id="section-11-2">The construction, originally implemented in the libsodium cryptographic library and exposed under the name "crypto_box_curve25519xchacha20poly1305", uses the Curve25119 elliptic curve in Montgomery form and the <code>hchacha20</code> hash function for key exchange, the <code>XChaCha20</code> stream cipher, and <code>Poly1305</code> for message authentication.<a href="#section-11-2" class="pilcrow">¶</a></p>
<p id="section-11-3">The public and secret keys are 32 bytes long in storage. The MAC is 16 bytes long, and is prepended to the ciphertext.<a href="#section-11-3" class="pilcrow">¶</a></p>
<p id="section-11-4">When using <code>Box-XChaChaPoly</code>, this construction necessitates the use of a 24 bytes nonce, that <span class="bcp14">MUST NOT</span> be reused for a given shared secret.<a href="#section-11-4" class="pilcrow">¶</a></p>
<p id="section-11-5">With a 24 bytes nonce, a question sent by a DNSCrypt client must be encrypted using the shared secret, and a nonce constructed as follows: 12 bytes chosen by the client followed by 12 NUL (<code>0x00</code>) bytes.<a href="#section-11-5" class="pilcrow">¶</a></p>
<p id="section-11-6">A response to this question <span class="bcp14">MUST</span> be encrypted using the shared secret, and a nonce constructed as follows: the bytes originally chosen by the client, followed by bytes chosen by the resolver.<a href="#section-11-6" class="pilcrow">¶</a></p>
<p id="section-11-7">Randomly selecting the resolver's portion of the nonce is <span class="bcp14">RECOMMENDED</span>.<a href="#section-11-7" class="pilcrow">¶</a></p>
<p id="section-11-8">The client's half of the nonce <span class="bcp14">MAY</span> include a timestamp in addition to a counter or to random bytes. Incorporating a timestamp allows for prompt elimination of responses to queries that were sent too long ago or are dated in the future. This practice enhances security and prevents potential replay attacks.<a href="#section-11-8" class="pilcrow">¶</a></p>
</section>
</div>
<div id="certificates">
<section id="section-12">
      <h2 id="name-certificates">
<a href="#section-12" class="section-number selfRef">12. </a><a href="#name-certificates" class="section-name selfRef">Certificates</a>
      </h2>
<p id="section-12-1">To initiate a DNSCrypt session, a client transmits an ordinary unencrypted <code>TXT</code> DNS query to the resolver's IP address and DNSCrypt port. The attempt is first made using UDP; if unsuccessful due to failure, timeout, or truncation, the client then proceeds with TCP.<a href="#section-12-1" class="pilcrow">¶</a></p>
<p id="section-12-2">Resolvers are not required to serve certificates both on UDP and TCP.<a href="#section-12-2" class="pilcrow">¶</a></p>
<p id="section-12-3">The name in the question (<code>&lt;provider name</code>) <span class="bcp14">MUST</span> follow this scheme:<a href="#section-12-3" class="pilcrow">¶</a></p>
<p id="section-12-4"><code>&lt;protocol-major-version&gt; . dnscrypt-cert . &lt;zone&gt;</code><a href="#section-12-4" class="pilcrow">¶</a></p>
<p id="section-12-5">A major protocol version has only one certificate format.<a href="#section-12-5" class="pilcrow">¶</a></p>
<p id="section-12-6">A DNSCrypt client implementing the second version of the protocol <span class="bcp14">MUST</span> send a query with the <code>TXT</code> type and a name of the form:<a href="#section-12-6" class="pilcrow">¶</a></p>
<p id="section-12-7"><code>2.dnscrypt-cert.example.com</code><a href="#section-12-7" class="pilcrow">¶</a></p>
<p id="section-12-8">The zone <span class="bcp14">MUST</span> be a valid DNS name, but <span class="bcp14">MAY</span> not be registered in the DNS hierarchy.<a href="#section-12-8" class="pilcrow">¶</a></p>
<p id="section-12-9">A single provider name can be shared by multiple resolvers operated by the same entity, and a resolver can respond to multiple provider
names, especially to support multiple protocol versions simultaneously.<a href="#section-12-9" class="pilcrow">¶</a></p>
<p id="section-12-10">In order to use a DNSCrypt-enabled resolver, a client must know the following information:<a href="#section-12-10" class="pilcrow">¶</a></p>
<ul class="normal">
<li class="normal" id="section-12-11.1">
          <p id="section-12-11.1.1">The resolver IP address and port<a href="#section-12-11.1.1" class="pilcrow">¶</a></p>
</li>
        <li class="normal" id="section-12-11.2">
          <p id="section-12-11.2.1">The provider name<a href="#section-12-11.2.1" class="pilcrow">¶</a></p>
</li>
        <li class="normal" id="section-12-11.3">
          <p id="section-12-11.3.1">The provider public key<a href="#section-12-11.3.1" class="pilcrow">¶</a></p>
</li>
      </ul>
<p id="section-12-12">The provider public key is a long-term key whose sole purpose is to verify the certificates. It is never used to encrypt or verify DNS queries. A single provider public key can be employed to sign multiple certificates.<a href="#section-12-12" class="pilcrow">¶</a></p>
<p id="section-12-13">For example, an organization operating multiple resolvers can use a unique provider name and provider public key across all resolvers,
and just provide a list of IP addresses and ports. Each resolver <span class="bcp14">MAY</span> have its unique set of certificates that can be signed with the
same key.<a href="#section-12-13" class="pilcrow">¶</a></p>
<p id="section-12-14">It is <span class="bcp14">RECOMMENDED</span> that certificates are signed using specialized hardware rather than directly on the resolvers themselves. Once signed, resolvers <span class="bcp14">SHOULD</span> make these certificates available to clients. Signing certificates on dedicated hardware helps ensure security and integrity, as it isolates the process from potential vulnerabilities present in the resolver's system.<a href="#section-12-14" class="pilcrow">¶</a></p>
<p id="section-12-15">A successful response to a certificate request contains one or more <code>TXT</code> records, each record containing a certificate encoded as follows:<a href="#section-12-15" class="pilcrow">¶</a></p>
<ul class="normal">
<li class="normal" id="section-12-16.1">
          <p id="section-12-16.1.1"><code>&lt;cert&gt;</code>: <code>&lt;cert-magic&gt; &lt;es-version&gt; &lt;protocol-minor-version&gt; &lt;signature&gt; &lt;resolver-pk&gt; &lt;client-magic&gt; &lt;serial&gt; &lt;ts-start&gt; &lt;ts-end&gt; &lt;extensions&gt;</code><a href="#section-12-16.1.1" class="pilcrow">¶</a></p>
</li>
        <li class="normal" id="section-12-16.2">
          <p id="section-12-16.2.1"><code>&lt;cert-magic&gt;</code>: <code>0x44 0x4e 0x53 0x43</code><a href="#section-12-16.2.1" class="pilcrow">¶</a></p>
</li>
        <li class="normal" id="section-12-16.3">
          <p id="section-12-16.3.1"><code>&lt;es-version&gt;</code>: the cryptographic construction to use with this certificate. For Box-XChaChaPoly, <code>&lt;es-version&gt;</code> <span class="bcp14">MUST</span> be <code>0x00 0x02</code>.<a href="#section-12-16.3.1" class="pilcrow">¶</a></p>
</li>
        <li class="normal" id="section-12-16.4">
          <p id="section-12-16.4.1"><code>&lt;protocol-minor-version&gt;</code>: <code>0x00 0x00</code><a href="#section-12-16.4.1" class="pilcrow">¶</a></p>
</li>
        <li class="normal" id="section-12-16.5">
          <p id="section-12-16.5.1"><code>&lt;signature&gt;</code>: a 64-byte signature of <code>(&lt;resolver-pk&gt; &lt;client-magic&gt; &lt;serial&gt; &lt;ts-start&gt; &lt;ts-end&gt; &lt;extensions&gt;)</code> using the Ed25519 algorithm and the provider secret key. Ed25519 <span class="bcp14">MUST</span> be used in this version of the protocol.<a href="#section-12-16.5.1" class="pilcrow">¶</a></p>
</li>
        <li class="normal" id="section-12-16.6">
          <p id="section-12-16.6.1"><code>&lt;resolver-pk&gt;</code>: the resolver short-term public key, which is 32 bytes when using X25519.<a href="#section-12-16.6.1" class="pilcrow">¶</a></p>
</li>
        <li class="normal" id="section-12-16.7">
          <p id="section-12-16.7.1"><code>&lt;client-magic&gt;</code>: The first 8 bytes of a client query that was built using the information from this certificate. It <span class="bcp14">MAY</span> be a truncated public key. Two valid certificates cannot share the same <code>&lt;client-magic&gt;</code>. <code>&lt;client-magic&gt;</code> <span class="bcp14">MUST NOT</span> start with <code>0x00 0x00 0x00 0x00 0x00 0x00 0x00</code> (seven all-zero bytes) in order to avoid confusion with the QUIC protocol.<a href="#section-12-16.7.1" class="pilcrow">¶</a></p>
</li>
        <li class="normal" id="section-12-16.8">
          <p id="section-12-16.8.1"><code>&lt;serial&gt;</code>: a 4-byte serial number in big-endian format. If more than one certificate is valid, the client <span class="bcp14">MUST</span> prefer the certificate with a higher serial number.<a href="#section-12-16.8.1" class="pilcrow">¶</a></p>
</li>
        <li class="normal" id="section-12-16.9">
          <p id="section-12-16.9.1"><code>&lt;ts-start&gt;</code>: the date the certificate is valid from, as a big-endian 4-byte unsigned Unix timestamp.<a href="#section-12-16.9.1" class="pilcrow">¶</a></p>
</li>
        <li class="normal" id="section-12-16.10">
          <p id="section-12-16.10.1"><code>&lt;ts-end&gt;</code>: the date the certificate is valid until (inclusive), as a big-endian 4-byte unsigned Unix timestamp.<a href="#section-12-16.10.1" class="pilcrow">¶</a></p>
</li>
        <li class="normal" id="section-12-16.11">
          <p id="section-12-16.11.1"><code>&lt;extensions&gt;</code>: empty in the current protocol version, but may contain additional data in future revisions, including minor versions. The computation and verification of the signature <span class="bcp14">MUST</span> include the extensions. An implementation not supporting these extensions <span class="bcp14">MUST</span> ignore them.<a href="#section-12-16.11.1" class="pilcrow">¶</a></p>
</li>
      </ul>
<p id="section-12-17">Certificates made of this information, without extensions, are 116 bytes long. With the addition of <code>&lt;cert-magic&gt;</code>, <code>&lt;es-version&gt;</code>, and <code>&lt;protocol-minor-version&gt;</code>, the record is 124 bytes long.<a href="#section-12-17" class="pilcrow">¶</a></p>
<p id="section-12-18">After receiving a set of certificates, the client checks their validity based on the current date, filters out the ones designed for encryption systems that are not supported by the client, and chooses the certificate with the higher serial number.<a href="#section-12-18" class="pilcrow">¶</a></p>
<p id="section-12-19">DNSCrypt queries sent by the client <span class="bcp14">MUST</span> use the <code>&lt;client-magic&gt;</code> header of the chosen certificate, as well as the specified encryption system and public key.<a href="#section-12-19" class="pilcrow">¶</a></p>
<p id="section-12-20">The client <span class="bcp14">MUST</span> check for new certificates every hour and switch to a new certificate if:<a href="#section-12-20" class="pilcrow">¶</a></p>
<ul class="normal">
<li class="normal" id="section-12-21.1">
          <p id="section-12-21.1.1">The current certificate is not present or not valid anymore,<a href="#section-12-21.1.1" class="pilcrow">¶</a></p>
</li>
      </ul>
<p id="section-12-22">or<a href="#section-12-22" class="pilcrow">¶</a></p>
<ul class="normal">
<li class="normal" id="section-12-23.1">
          <p id="section-12-23.1.1">A certificate with a higher serial number than the current one is available.<a href="#section-12-23.1.1" class="pilcrow">¶</a></p>
</li>
      </ul>
</section>
</div>
<div id="implementation-status">
<section id="section-13">
      <h2 id="name-implementation-status">
<a href="#section-13" class="section-number selfRef">13. </a><a href="#name-implementation-status" class="section-name selfRef">Implementation Status</a>
      </h2>
<p id="section-13-1"><em>This note is to be removed before publishing as an RFC.</em><a href="#section-13-1" class="pilcrow">¶</a></p>
<p id="section-13-2">Multiple implementations of the protocol described in this document have been developed and verified for interoperability.<a href="#section-13-2" class="pilcrow">¶</a></p>
<p id="section-13-3">A comprehensive list of known implementations can be found at <span><a href="https://dnscrypt.info/implementations">https://dnscrypt.info/implementations</a></span>.<a href="#section-13-3" class="pilcrow">¶</a></p>
</section>
</div>
<div id="security-considerations">
<section id="section-14">
      <h2 id="name-security-considerations">
<a href="#section-14" class="section-number selfRef">14. </a><a href="#name-security-considerations" class="section-name selfRef">Security Considerations</a>
      </h2>
<p id="section-14-1">DNSCrypt does not protect against attacks on DNS infrastructure.<a href="#section-14-1" class="pilcrow">¶</a></p>
</section>
</div>
<div id="operational-considerations">
<section id="section-15">
      <h2 id="name-operational-considerations">
<a href="#section-15" class="section-number selfRef">15. </a><a href="#name-operational-considerations" class="section-name selfRef">Operational Considerations</a>
      </h2>
<p id="section-15-1">Special attention should be paid to the uniqueness of the generated secret keys.<a href="#section-15-1" class="pilcrow">¶</a></p>
<p id="section-15-2">Client public keys can be used by resolvers to authenticate clients, link queries to customer accounts, and unlock business-specific features such as redirecting specific domain names to a sinkhole.<a href="#section-15-2" class="pilcrow">¶</a></p>
<p id="section-15-3">Resolvers accessible from any client IP address can also opt for only responding to a set of whitelisted public keys.<a href="#section-15-3" class="pilcrow">¶</a></p>
<p id="section-15-4">Resolvers accepting queries from any client <span class="bcp14">MUST</span> accept any client public key. In particular, an anonymous client can generate a new key pair for every session, or even for every query. This mitigates the ability for a resolver to group queries by client public keys and discover the set of IP addresses a user might have been operating.<a href="#section-15-4" class="pilcrow">¶</a></p>
<p id="section-15-5">Resolvers <span class="bcp14">MUST</span> rotate the short-term key pair every 24 hours at most, and <span class="bcp14">MUST</span> throw away the previous secret key. After a key rotation, a resolver <span class="bcp14">MUST</span> still accept all the previous keys that haven't expired.<a href="#section-15-5" class="pilcrow">¶</a></p>
<p id="section-15-6">Provider public keys <span class="bcp14">MAY</span> be published as DNSSEC-signed <code>TXT</code> records, in the same zone as the provider name. For example, a query for the <code>TXT</code> type on the name <code>"2.pubkey.example.com"</code> may return a signed record containing a hexadecimal-encoded provider public key for the provider name <code>"2.dnscrypt-cert.example.com"</code>.<a href="#section-15-6" class="pilcrow">¶</a></p>
<p id="section-15-7">As a client is likely to reuse the same key pair many times, servers are encouraged to cache shared keys instead of performing the X25519 operation for each query. This makes the computational overhead of DNSCrypt negligible compared to plain DNS.<a href="#section-15-7" class="pilcrow">¶</a></p>
</section>
</div>
<div id="iana-considerations">
<section id="section-16">
      <h2 id="name-iana-considerations">
<a href="#section-16" class="section-number selfRef">16. </a><a href="#name-iana-considerations" class="section-name selfRef">IANA Considerations</a>
      </h2>
<p id="section-16-1">This document has no IANA actions.<a href="#section-16-1" class="pilcrow">¶</a></p>
</section>
</div>
<div id="appendix-1-the-box-xchachapoly-algorithm">
<section id="section-17">
      <h2 id="name-appendix-1-the-box-xchachap">
<a href="#section-17" class="section-number selfRef">17. </a><a href="#name-appendix-1-the-box-xchachap" class="section-name selfRef">Appendix 1: The Box-XChaChaPoly Algorithm</a>
      </h2>
<p id="section-17-1">The <code>Box-XChaChaPoly</code> algorithm combines the <code>X25519</code> <span>[<a href="#RFC7748" class="cite xref">RFC7748</a>]</span> key exchange mechanism with a variant of the ChaCha20-Poly1305 construction specified in <span>[<a href="#RFC8439" class="cite xref">RFC8439</a>]</span>.<a href="#section-17-1" class="pilcrow">¶</a></p>
<div id="hchacha20">
<section id="section-17.1">
        <h3 id="name-hchacha20">
<a href="#section-17.1" class="section-number selfRef">17.1. </a><a href="#name-hchacha20" class="section-name selfRef">HChaCha20</a>
        </h3>
<p id="section-17.1-1"><code>HChaCha20</code> is an intermediate step based on the construction and security proof used to create <code>XSalsa20</code>, an extended-nonce Salsa20 variant.<a href="#section-17.1-1" class="pilcrow">¶</a></p>
<p id="section-17.1-2"><code>HChaCha20</code> is initialized in the same way as the ChaCha20 cipher defined in <span>[<a href="#RFC8439" class="cite xref">RFC8439</a>]</span>, except that <code>HChaCha20</code> uses a 128-bit nonce and has no counter. Instead, the block counter is replaced by the first 32 bits of the nonce.<a href="#section-17.1-2" class="pilcrow">¶</a></p>
<p id="section-17.1-3">Consider the two figures below, where each non-whitespace character represents one nibble of information about the ChaCha states (all numbers little-endian):<a href="#section-17.1-3" class="pilcrow">¶</a></p>
<div class="alignLeft art-text artwork" id="section-17.1-4">
<pre>
                  cccccccc  cccccccc  cccccccc  cccccccc
                  kkkkkkkk  kkkkkkkk  kkkkkkkk  kkkkkkkk
                  kkkkkkkk  kkkkkkkk  kkkkkkkk  kkkkkkkk
                  bbbbbbbb  nnnnnnnn  nnnnnnnn  nnnnnnnn

           ChaCha20 State: c=constant k=key b=blockcount n=nonce


                  cccccccc  cccccccc  cccccccc  cccccccc
                  kkkkkkkk  kkkkkkkk  kkkkkkkk  kkkkkkkk
                  kkkkkkkk  kkkkkkkk  kkkkkkkk  kkkkkkkk
                  nnnnnnnn  nnnnnnnn  nnnnnnnn  nnnnnnnn

                 HChaCha20 State: c=constant k=key n=nonce
</pre><a href="#section-17.1-4" class="pilcrow">¶</a>
</div>
<p id="section-17.1-5">After initialization, proceed through the ChaCha rounds as usual. Once the 20 ChaCha rounds have been completed, the first 128 bits and last 128 bits of the ChaCha state (both little-endian) are concatenated, and this 256-bit subkey is returned.<a href="#section-17.1-5" class="pilcrow">¶</a></p>
</section>
</div>
<div id="test-vector-for-the-hchacha20-block-function">
<section id="section-17.2">
        <h3 id="name-test-vector-for-the-hchacha">
<a href="#section-17.2" class="section-number selfRef">17.2. </a><a href="#name-test-vector-for-the-hchacha" class="section-name selfRef">Test Vector For The HChaCha20 Block Function</a>
        </h3>
<div class="alignLeft art-text artwork" id="section-17.2-1">
<pre>
   o  Key = 00:01:02:03:04:05:06:07:08:09:0a:0b:0c:0d:0e:0f:10:11:12:13:
      14:15:16:17:18:19:1a:1b:1c:1d:1e:1f.  The key is a sequence of
      octets with no particular structure before we copy it into the
      HChaCha state.

   o  Nonce = (00:00:00:09:00:00:00:4a:00:00:00:00:31:41:59:27)

   After setting up the HChaCha state, it looks like this:

                    61707865 3320646e 79622d32 6b206574
                    03020100 07060504 0b0a0908 0f0e0d0c
                    13121110 17161514 1b1a1918 1f1e1d1c
                    09000000 4a000000 00000000 27594131

                     ChaCha state with the key setup.

   After running 20 rounds (10 column rounds interleaved with 10
   "diagonal rounds"), the HChaCha state looks like this:

                    423b4182 fe7bb227 50420ed3 737d878a
                    0aa76448 7954cdf3 846acd37 7b3c58ad
                    77e35583 83e77c12 e0076a2d bc6cd0e5
                    d5e4f9a0 53a8748a 13c42ec1 dcecd326

                       HChaCha state after 20 rounds

   HChaCha20 will then return only the first and last rows, in little
   endian, resulting in the following 256-bit key:

                    82413b42 27b27bfe d30e4250 8a877d73
                    a0f9e4d5 8a74a853 c12ec413 26d3ecdc

                        Resultant HChaCha20 subkey
</pre><a href="#section-17.2-1" class="pilcrow">¶</a>
</div>
</section>
</div>
<div id="chacha20djb">
<section id="section-17.3">
        <h3 id="name-chacha20_djb">
<a href="#section-17.3" class="section-number selfRef">17.3. </a><a href="#name-chacha20_djb" class="section-name selfRef">ChaCha20_DJB</a>
        </h3>
<p id="section-17.3-1">ChaCha20 was originally designed to have a 8 byte nonce.<a href="#section-17.3-1" class="pilcrow">¶</a></p>
<p id="section-17.3-2">For the needs of TLS, <span>[<a href="#RFC8439" class="cite xref">RFC8439</a>]</span> changed this by setting <code>N_MIN</code> and <code>N_MAX</code> to <code>12</code>, at the expense of a smaller internal counter.<a href="#section-17.3-2" class="pilcrow">¶</a></p>
<p id="section-17.3-3">DNSCrypt uses ChaCha20 as originally specified, with <code>N_MIN = N_MAX = 8</code>. We refer to this variant as <code>ChaCha20_DJB</code>.<a href="#section-17.3-3" class="pilcrow">¶</a></p>
<p id="section-17.3-4">Common implementations may just refer to it as <code>ChaCha20</code>, and the IETF version as <code>ChaCha20-IETF</code>.<a href="#section-17.3-4" class="pilcrow">¶</a></p>
<p id="section-17.3-5">The internal counter in <code>ChaCha20_DJB</code> is 4 bytes larger than <code>ChaCha20</code>. There are no other differences between <code>ChaCha20_DJB</code> and <code>ChaCha20</code>.<a href="#section-17.3-5" class="pilcrow">¶</a></p>
</section>
</div>
<div id="xchacha20djb">
<section id="section-17.4">
        <h3 id="name-xchacha20_djb">
<a href="#section-17.4" class="section-number selfRef">17.4. </a><a href="#name-xchacha20_djb" class="section-name selfRef">XChaCha20_DJB</a>
        </h3>
<p id="section-17.4-1">XChaCha20_DJB can be constructed from an existing ChaCha20 implementation and the HChaCha20 function.<a href="#section-17.4-1" class="pilcrow">¶</a></p>
<p id="section-17.4-2">All that needs to be done is:<a href="#section-17.4-2" class="pilcrow">¶</a></p>
<ol start="1" type="1" class="normal type-1" id="section-17.4-3">
<li id="section-17.4-3.1">
            <p id="section-17.4-3.1.1">Pass the key and the first 16 bytes of the 24-byte nonce to <code>HChaCha20</code> to obtain the subkey.<a href="#section-17.4-3.1.1" class="pilcrow">¶</a></p>
</li>
          <li id="section-17.4-3.2">
            <p id="section-17.4-3.2.1">Use the subkey and remaining 8 byte nonce with <code>ChaCha20_DJB</code>.<a href="#section-17.4-3.2.1" class="pilcrow">¶</a></p>
</li>
        </ol>
</section>
</div>
<div id="xchacha20djb-poly1305">
<section id="section-17.5">
        <h3 id="name-xchacha20_djb-poly1305">
<a href="#section-17.5" class="section-number selfRef">17.5. </a><a href="#name-xchacha20_djb-poly1305" class="section-name selfRef">XChaCha20_DJB-Poly1305</a>
        </h3>
<p id="section-17.5-1">XChaCha20 is a stream cipher and offers no integrity guarantees without being combined with a MAC algorithm (e.g. Poly1305).<a href="#section-17.5-1" class="pilcrow">¶</a></p>
<p id="section-17.5-2"><code>XChaCha20_DJB-Poly1305</code> adds an authentication tag to the ciphertext encrypted with <code>XChaCha20_DJB</code>.<a href="#section-17.5-2" class="pilcrow">¶</a></p>
<p id="section-17.5-3">The Poly1305 key is computed as in <span>[<a href="#RFC8439" class="cite xref">RFC8439</a>]</span>, by encrypting an empty block.<a href="#section-17.5-3" class="pilcrow">¶</a></p>
<p id="section-17.5-4">Finally, the output of the Poly1305 function is prepended to the ciphertext:<a href="#section-17.5-4" class="pilcrow">¶</a></p>
<ul class="normal">
<li class="normal" id="section-17.5-5.1">
            <p id="section-17.5-5.1.1"><code>&lt;k&gt;</code>: encryption key<a href="#section-17.5-5.1.1" class="pilcrow">¶</a></p>
</li>
          <li class="normal" id="section-17.5-5.2">
            <p id="section-17.5-5.2.1"><code>&lt;m&gt;</code>: message to encrypt<a href="#section-17.5-5.2.1" class="pilcrow">¶</a></p>
</li>
          <li class="normal" id="section-17.5-5.3">
            <p id="section-17.5-5.3.1"><code>&lt;ct&gt;</code>: <code>XChaCha20_DJB(&lt;k&gt;, &lt;m&gt;)</code><a href="#section-17.5-5.3.1" class="pilcrow">¶</a></p>
</li>
          <li class="normal" id="section-17.5-5.4">
            <p id="section-17.5-5.4.1"><code>XChaCha20_DJB-Poly1305(&lt;k&gt;, &lt;m&gt;)</code>: <code>Poly1305(&lt;ct&gt;) || &lt;ct&gt;</code><a href="#section-17.5-5.4.1" class="pilcrow">¶</a></p>
</li>
        </ul>
</section>
</div>
<div id="the-box-xchachapoly-algorithm">
<section id="section-17.6">
        <h3 id="name-the-box-xchachapoly-algorit">
<a href="#section-17.6" class="section-number selfRef">17.6. </a><a href="#name-the-box-xchachapoly-algorit" class="section-name selfRef">The Box-XChaChaPoly Algorithm</a>
        </h3>
<p id="section-17.6-1">The Box-XChaChaPoly algorithm combines the key exchange mechanism X25519 defined <span>[<a href="#RFC7748" class="cite xref">RFC7748</a>]</span> with the <code>XChaCha20_DJB-Poly1305</code> authenticated encryption algorithm.<a href="#section-17.6-1" class="pilcrow">¶</a></p>
<ul class="normal">
<li class="normal" id="section-17.6-2.1">
            <p id="section-17.6-2.1.1"><code>&lt;k&gt;</code>: encryption key<a href="#section-17.6-2.1.1" class="pilcrow">¶</a></p>
</li>
          <li class="normal" id="section-17.6-2.2">
            <p id="section-17.6-2.2.1"><code>&lt;m&gt;</code>: message to encrypt<a href="#section-17.6-2.2.1" class="pilcrow">¶</a></p>
</li>
          <li class="normal" id="section-17.6-2.3">
            <p id="section-17.6-2.3.1"><code>&lt;pk&gt;</code>: recipent's public key<a href="#section-17.6-2.3.1" class="pilcrow">¶</a></p>
</li>
          <li class="normal" id="section-17.6-2.4">
            <p id="section-17.6-2.4.1"><code>&lt;sk&gt;</code>: sender's secret key<a href="#section-17.6-2.4.1" class="pilcrow">¶</a></p>
</li>
          <li class="normal" id="section-17.6-2.5">
            <p id="section-17.6-2.5.1"><code>&lt;sk'&gt;</code>: <code>HChaCha20(X25519(&lt;pk&gt;, &lt;sk&gt;))</code><a href="#section-17.6-2.5.1" class="pilcrow">¶</a></p>
</li>
          <li class="normal" id="section-17.6-2.6">
            <p id="section-17.6-2.6.1"><code>Box-XChaChaPoly(pk, sk, m)</code>: <code>XChaCha20_DJB-Poly1305(&lt;sk'&gt;, &lt;m&gt;)</code><a href="#section-17.6-2.6.1" class="pilcrow">¶</a></p>
</li>
        </ul>
</section>
</div>
</section>
</div>
<div id="sec-normative-references">
<section id="section-18">
      <h2 id="name-normative-references">
<a href="#section-18" class="section-number selfRef">18. </a><a href="#name-normative-references" class="section-name selfRef">Normative References</a>
      </h2>
<dl class="references">
<dt id="RFC1035">[RFC1035]</dt>
      <dd>
<span class="refAuthor">Mockapetris, P.</span>, <span class="refTitle">"Domain names - implementation and specification"</span>, <span class="seriesInfo">STD 13</span>, <span class="seriesInfo">RFC 1035</span>, <span class="seriesInfo">DOI 10.17487/RFC1035</span>, <time datetime="1987-11" class="refDate">November 1987</time>, <span>&lt;<a href="https://www.rfc-editor.org/info/rfc1035">https://www.rfc-editor.org/info/rfc1035</a>&gt;</span>. </dd>
<dd class="break"></dd>
<dt id="RFC2119">[RFC2119]</dt>
      <dd>
<span class="refAuthor">Bradner, S.</span>, <span class="refTitle">"Key words for use in RFCs to Indicate Requirement Levels"</span>, <span class="seriesInfo">BCP 14</span>, <span class="seriesInfo">RFC 2119</span>, <span class="seriesInfo">DOI 10.17487/RFC2119</span>, <time datetime="1997-03" class="refDate">March 1997</time>, <span>&lt;<a href="https://www.rfc-editor.org/info/rfc2119">https://www.rfc-editor.org/info/rfc2119</a>&gt;</span>. </dd>
<dd class="break"></dd>
<dt id="RFC8174">[RFC8174]</dt>
      <dd>
<span class="refAuthor">Leiba, B.</span>, <span class="refTitle">"Ambiguity of Uppercase vs Lowercase in RFC 2119 Key Words"</span>, <span class="seriesInfo">BCP 14</span>, <span class="seriesInfo">RFC 8174</span>, <span class="seriesInfo">DOI 10.17487/RFC8174</span>, <time datetime="2017-05" class="refDate">May 2017</time>, <span>&lt;<a href="https://www.rfc-editor.org/info/rfc8174">https://www.rfc-editor.org/info/rfc8174</a>&gt;</span>. </dd>
<dd class="break"></dd>
<dt id="RFC7748">[RFC7748]</dt>
      <dd>
<span class="refAuthor">Langley, A.</span>, <span class="refAuthor">Hamburg, M.</span>, and <span class="refAuthor">S. Turner</span>, <span class="refTitle">"Elliptic Curves for Security"</span>, <span class="seriesInfo">RFC 7748</span>, <span class="seriesInfo">DOI 10.17487/RFC7748</span>, <time datetime="2016-01" class="refDate">January 2016</time>, <span>&lt;<a href="https://www.rfc-editor.org/info/rfc7748">https://www.rfc-editor.org/info/rfc7748</a>&gt;</span>. </dd>
<dd class="break"></dd>
<dt id="RFC8439">[RFC8439]</dt>
    <dd>
<span class="refAuthor">Nir, Y.</span> and <span class="refAuthor">A. Langley</span>, <span class="refTitle">"ChaCha20 and Poly1305 for IETF Protocols"</span>, <span class="seriesInfo">RFC 8439</span>, <span class="seriesInfo">DOI 10.17487/RFC8439</span>, <time datetime="2018-06" class="refDate">June 2018</time>, <span>&lt;<a href="https://www.rfc-editor.org/info/rfc8439">https://www.rfc-editor.org/info/rfc8439</a>&gt;</span>. </dd>
<dd class="break"></dd>
</dl>
</section>
</div>
<div id="authors-addresses">
<section id="appendix-A">
      <h2 id="name-authors-address">
<a href="#name-authors-address" class="section-name selfRef">Author's Address</a>
      </h2>
<address class="vcard">
        <div dir="auto" class="left"><span class="fn nameRole">Frank Denis</span></div>
<div dir="auto" class="left"><span class="org">Individual Contributor</span></div>
<div class="email">
<span>Email:</span>
<a href="mailto:fde@00f.net" class="email">fde@00f.net</a>
</div>
</address>
</section>
</div>
<script>const toc = document.getElementById("toc");
toc.querySelector("h2").addEventListener("click", e => {
  toc.classList.toggle("active");
});
toc.querySelector("nav").addEventListener("click", e => {
  toc.classList.remove("active");
});
</script>
</body>
</html>
